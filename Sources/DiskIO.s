*------------------------------------------------------------------------------
* Low Level Read/Write/Format Disk Code for Commodore Amiga Dos Disks
*
* Copyright (c) 1988-92 Rob Northen Computing, U.K. All Rights Reserved.
*
* File: DISKIO.S
*
* Date: 07.09.92
*------------------------------------------------------------------------------


*------------------------------------------------------------------------------
* Low Level Read/Write/Format Disk Code for AmigaDos Disks
* on entry,
*	d0.w = drive number
*		0 = DF0
*		1 = DF1
*		2 = DF2
*		3 = DF3
*		4 = DF0, side 0 only
*		5 = DF1, side 0 only
*		6 = DF2, side 0 only
*		7 = DF3, side 0 only
*	d1.w = start sector no.
*		(0-879 for single sided disk, 0-1759 for double sided disk)
*	d2.w = number of sectors to read/write
*		0 = turn motor off (bit 15 of d3 must be set)
*	d3.w = function
*		0 = read sectors
*		1 = write sectors
*		2 = format track
*			a1.l = address of $3300 byte buffer
*			d1.w = sector no. of track to format
*			       ie. 0=track 0, side 0
*			          11=track 0, side 1 or track 1, side 0
*				  depending upon d0.w
*			d2.w = sectors to format
*			       ie.11=1 track
*			          22=2 tracks
*	bit 15 of d3.w controls whether the drive motor is turned off
*	after use. If bit 15 is clear the drive motor is left on. If
*	bit 15 is set the drive motor is turned off. Leave the drive
*	motor on if another disk operation is to be made soon after
*	the current one.
*
*	a0.l = disk buffer address for transfer
*	a1.l = workspace buffer, ($3300 bytes of CHIPMEM required)
* on exit,
*	d0.l = error no., if d0.l <> 0 then d1.l = sector offset in error
*		00 = no error
*		21 = No Sector Header
*		22 = Bad Sector Preamble
*		23 = Bad Sector ID
*		24 = Bad Sector Header Checksum
*		25 = Bad Sector Sum
*		26 = Too Few Sectors
*		27 = Bad Sector Header
*		28 = Write Protected
*		29 = No Disk in Drive
*		30 = Seek Error
*		34 = Drive In Use
*		-1 = DMA timeout
*
* Note: The disk code uses Timer A of CIA B
*       Master DMA (bit 9, $dff096) must be enabled
*	The blitter is not used
*------------------------------------------------------------------------------
diskio
		dc.l $48E77FFC,$4E56FFDC,$38000244,$00033D44,$FFDC3D41,$FFDE3D42,$FFE03D43,$FFE22D48
		dc.l $FFE42D49,$FFE8E458,$02400001,$52403D40,$FFEC7000,$36026700,$0088701E,$D641B67C
		dc.l $06E06E00,$00A60281,$0000FFFF,$82FC000B,$0C6E0001,$FFEC6702,$D2413D41,$FFEE4841
		dc.l $3D41FFF0,$610005DC,$4A2EFFE3,$67046100,$0452302E,$FFF0720B,$9240B26E,$FFE06F04
		dc.l $322EFFE0,$3D41FFF2,$616A6634,$4A2EFFE3,$67066100,$01506628,$302EFFE0,$906EFFF2
		dc.l $671E3D40,$FFE0302E,$FFF2E188,$D080D1AE,$FFE4426E,$FFF0302E,$FFECD16E,$FFEE60B2
		dc.l $2F006100,$0550201F,$67207200,$322EFFEE,$0C6E0001,$FFEC6702,$E249C2FC,$000BD26E
		dc.l $FFF0D26E,$FFFA2F41,$00284E5E,$4A804CDF,$3FFE4E75,$7802426E,$FFFC426E,$FFFA426E
		dc.l $FFF8342E,$FFEE6100,$05526600,$00B8701D,$08390002,$00BFE001,$670000AA,$70000C2E
		dc.l $0002FFE3,$670000BA,$2A6EFFE8,$4BED0400,$2ABCAAAA,$AAAA3B7C,$44890004,$6100030E
		dc.l $61000170,$667E302E,$FFF4674E,$C0FC0440,$41ED0006,$61000448,$49F900DF,$F01E6100
		dc.l $01AA6678,$0C2E0001,$FFE3670A,$302EFFFA,$906EFFF2,$676A2A6E,$FFE84BED,$0400302E
		dc.l $FFF4C0FC,$0440DBC0,$2ABCAAAA,$AAAA3B7C,$44890004,$204D6100,$03BC302E,$FFF66718
		dc.l $C0FC0440,$41ED0006,$610003F4,$49EEFFFE,$42546100,$01566624,$302EFFFA,$906EFFF2
		dc.l $671E701A,$2F007402,$61000490,$610004DA,$201F0839,$000200BF,$E0016704,$51CCFF18
		dc.l $6000041E,$7802426E,$FFFA0C2E,$0002FFE3,$660A302E,$FFEE206E,$FFE86170,$61000502
		dc.l $70646100,$0536701C,$08390003,$00BFE001,$674E41F9,$00DFF000,$317C4000,$0024216E
		dc.l $FFE80020,$317C6600,$009E317C,$9100009E,$0C6E0050,$FFEE6506,$317CA000,$009E317C
		dc.l $80100096,$317C0002,$009C317C,$D9610024,$317CD961,$00246100,$03846704,$51CCFF9E
		dc.l $2F007002,$610004D4,$201F4E75,$26000043,$FF004843,$363C000B,$41E80400,$584820FC
		dc.l $44894489,$20036100,$02C241E8,$FFF86100,$02C47228,$61000212,$610002B0,$41E8FFF8
		dc.l $610002B2,$41E80410,$06430100,$530366CC,$4E75740A,$41ED0006,$303C0040,$610002E0
		dc.l $6100031A,$66366100,$01CC6706,$51CAFFE6,$602C6100,$018A662A,$B26EFFEE,$6624B43C
		dc.l $000B6C1E,$B63C000B,$6E185303,$3D43FFF4,$3D7C000B,$FFF6976E,$FFF67000,$4E757018
		dc.l $4E75701B,$4E757019,$4E752A6E,$FFE84BED,$0400302E,$FFF8C0FC,$0440DBC0,$203C0000
		dc.l $17706100,$0436082C,$00010001,$660000F6,$6100041A,$670000F2,$4AAD0440,$67E86100
		dc.l $015466BA,$61000118,$66B8B26E,$FFEE66B2,$360241ED,$00086100,$0126103C,$000B902E
		dc.l $FFF941ED,$00086100,$01E26100,$013641ED,$00306100,$01D6B66E,$FFF06D00,$009A302E
		dc.l $FFF2D06E,$FFF0B640,$6C00008C,$082C0001,$00016600,$0090302E,$FFFC0700,$66784A2E
		dc.l $FFE36732,$61000086,$206EFFE4,$D1C143ED,$00406100,$0168082C,$00010001,$666641ED
		dc.l $0040323C,$04006100,$00E041ED,$00386100,$017A6168,$604041ED,$0040323C,$04006100
		dc.l $00C82F00,$41ED0038,$61000094,$B09F6600,$FF16082C,$00010001,$662A6130,$41ED0040
		dc.l $226EFFE4,$D3C16100,$00EC6130,$302EFFFA,$B06EFFF2,$670E526E,$FFF80C6E,$000BFFF8
		dc.l $6600FEE8,$70004E75,$70FF4E75,$2203926E,$FFF0203C,$00000200,$C2C04E75,$302EFFFC
		dc.l $07C03D40,$FFFC526E,$FFFA4E75,$204D720A,$700041E8,$04402080,$51C9FFF8,$4E7541ED
		dc.l $0008611A,$36000243,$00FF3400,$E04A4840,$32000241,$00FFE048,$B03C00FF,$4E752018
		dc.l $22180280,$55555555,$02815555,$5555D080,$80814E75,$610C2F00,$41ED0030,$61E0B09F
		dc.l $4E7541ED,$00087228,$2F02E449,$53417000,$2418B580,$51C9FFFA,$241F0280,$55555555
		dc.l $4E75206E,$FFE8203C,$AAAAAAAA,$22002400,$26002800,$2A002C00,$2E0043E8,$04000C2E
		dc.l $0001FFE3,$670443E8,$32C048E1,$FF00B1C9,$66F84E75,$48E7F0E0,$707F45E8,$0200263C
		dc.l $55555555,$2218241A,$C283C483,$D2818282,$22C151C8,$FFF04CDF,$070F4E75,$48E7FCC0
		dc.l $C3482600,$E48B5383,$2A002011,$E2886142,$201941F0,$58FC613A,$91C551CB,$FFEE6114
		dc.l $D1C56110,$4CDF033F,$4E752F00,$E2886122,$201F611E,$10100828,$0000FFFF,$660C0800
		dc.l $0006660C,$08C00007,$60040880,$00071080,$4E750280,$55555555,$24000A82,$55555555
		dc.l $2202D482,$E28908C1,$001FC282,$80810828,$0000FFFF,$67040880,$001F20C0,$4E7543F9
		dc.l $00DFF000,$337C4000,$0024337C,$80100096,$337C6600,$009E337C,$9500009E,$337C4489
		dc.l $007E2348,$0020337C,$0002009C,$E2480040,$80003340,$00243340,$00244E75,$43F900DF
		dc.l $F000203C,$000009C4,$61000170,$08290001,$001F660A,$61000156,$66F270FF,$60027000
		dc.l $33FC0002,$00DFF09C,$33FC4000,$00DFF024,$4A804E75,$33FC0400,$00DFF09E,$4A6EFFE2
		dc.l $6A1E72FF,$13C100BF,$D100302E,$FFDC5680,$018113C1,$00BFD100,$01C113C1,$00BFD100
		dc.l $4E7572FF,$13C100BF,$D1000881,$000761D4,$203C0000,$00C86000,$00E248E7,$30002602
		dc.l $6100009E,$302EFFDC,$D04041FA,$01083030,$00006A04,$6132662A,$E248E24A,$72019440
		dc.l $670E6A04,$72FF4442,$70036150,$534266F8,$302EFFDC,$D04041FA,$00DC3183,$00006160
		dc.l $70004CDF,$000C4E75,$48E72000,$74550839,$000400BF,$E001670E,$700372FF,$611E51CA
		dc.l $FFEE701E,$6010302E,$FFDCD040,$41FA00A6,$42700000,$70004CDF,$00044E75,$2F00612A
		dc.l $4A016B04,$08800001,$08800000,$13C000BF,$D10008C0,$000013C0,$00BFD100,$201F603A
		dc.l $610813C0,$00BFD100,$4E7548A7,$6000302E,$FFDC1439,$00BFD100,$0002007F,$56000182
		dc.l $5700D040,$323B004E,$08010000,$67040882,$00021002,$4C9F0006,$4E75611E,$08390000
		dc.l $00BFDE00,$66F65380,$66F04E75,$08390000,$00BFDE00,$661C5380,$671813FC,$000800BF
		dc.l $DE0013FC,$008A00BF,$D40013FC,$000200BF,$D5004E75,$FFFFFFFF,$FFFFFFFF

